"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const debug = require("debug");
const rxjs_1 = require("rxjs");
const dgram_1 = require("dgram");
const constants_1 = require("./constants");
const keepalive = require("./packets/keep-alive");
const d = debug('pro-dj-link:search');
const _devices = new rxjs_1.BehaviorSubject([]);
exports.search = () => {
    const socket = dgram_1.createSocket({
        type: 'udp4',
        reuseAddr: true
    });
    socket.bind({
        port: constants_1.ANNOUNCEMENT_PORT
    }, () => {
        socket.setBroadcast(true);
        socket.setMulticastTTL(128);
    });
    socket.on('message', data => {
        if (keepalive.test(data)) {
            const { name, device, ip, mac } = keepalive.parse(data);
            d(`Player ${device} (${name})`, mac, ip);
        }
        else {
            d('50000', data);
        }
    });
};
exports.devices = _devices.asObservable();
//# sourceMappingURL=search.js.map